/*
 * battery_mgmt.c
 *
 *  Created on: 10 Jan 2026
 *      Author: michaelsmart
 */
#include "battery_mgmt.h"
#include "stm32f4xx_hal.h"

extern ADC_HandleTypeDef hadc1; // generated by CubeMX or your init code


uint8_t Get_Battery_Volt(void)
{

    float vRefVolts = 3.3f;
    (void)HAL_ADC_Start(&hadc1);
    (void)HAL_ADC_PollForConversion(&hadc1, 10);
    uint32_t raw = HAL_ADC_GetValue(&hadc1);
    (void)HAL_ADC_Stop(&hadc1);

    // 12-bit ADC full scale = 4095
    // VBAT channel reports VBAT/4 -> multiply by 4
    float vBat = (4.0f * vRefVolts * (float)raw) / 4095.0f;

    uint8_t milliVoltAboveVref = (uint8_t)((vBat-vRefVolts)*100);




    return milliVoltAboveVref;
}

